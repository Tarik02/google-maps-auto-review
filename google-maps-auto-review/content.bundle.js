(()=>{"use strict";const t=t=>new Promise((e=>setTimeout(e,t))),e=async(e,{timeout:a=3e4,interval:o=100}={})=>{const n=0===a?1/0:Date.now()+a;do{try{const t=e();if(null!==t)return t}catch(t){console.error(t)}await t(o)}while(Date.now()<n);throw new Error(`timeout ${a} expired`)},a=async(t,{root:a=document,timeout:o=3e4,interval:n=100}={})=>await e((()=>("function"==typeof a?a():a).querySelector(t)??null),{timeout:o,interval:n}),o=async(t,{root:a=document,timeout:o=3e4,interval:n=100}={})=>await e((()=>{const e="function"==typeof a?a():a;return document.evaluate(t,e,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue??null}),{timeout:o,interval:n}),n=(t,...e)=>new Promise(((a,o)=>{chrome.runtime.sendMessage({type:t,args:e},(({result:t,error:e})=>{e?o(new Error(e)):a(t)}))})),i=async()=>{const{text:i}=await n("requestData");(await a('[aria-label="Написати відгук"]')).click();const r=await a('[name="goog-reviews-write-widget"]'),c=["Одна зірка","Дві зірки","Три зірки","Чотири зірки","П’ять зірок"][2+Math.round(2*Math.random())];(await a(`[aria-label="${c}"]`,{root:()=>r.contentWindow.document})).click(),await(async(e,a)=>{e.focus(),await t(5),e.value=a,await t(5),e.dispatchEvent(new Event("input",{bubbles:!0})),await t(5)})(await a('[aria-label="Enter review"]',{root:()=>r.contentWindow.document}),i),(await a('[alt="Додати фотографії"]',{root:()=>r.contentWindow.document})).click(),console.log("waiting for picker"),await e((()=>!r.contentWindow.document.querySelector(".picker-dialog iframe")||null),{root:()=>r.contentWindow.document}),(await o("//span[contains(text(), 'Опублікувати')]",{root:()=>r.contentWindow.document})).click(),await t(2e3),(await o("//span[contains(text(), 'ГОТОВО')]|//span[contains(text(), 'НІ, ДЯКУЮ')]",{root:()=>r.contentWindow.document})).click(),await t(1e3)};let r=()=>{},c=!1;const l=()=>{c=!0;const t=document.createElement("div");t.classList.add("google-maps-auto-review"),t.innerText="Google Maps Auto Review Enabled",t.style.position="fixed",t.style.top=0,t.style.left=0,t.style.right=0,t.style.padding="5px",t.style.fontSize="10px",t.style.textAlign="center",t.style.backgroundColor="black",t.style.color="white",document.body.appendChild(t)},s=()=>{console.log("stopped"),c=!1;for(const t of document.querySelectorAll(".google-maps-auto-review"))t.remove()},w=async()=>{for(r();;)try{l(),await Promise.race([a('[aria-label="Написати відгук"]',{timeout:0}),new Promise(((t,e)=>{r=()=>{s(),e(new Error("cancel"))}}))]),await n("generateData"),await i()}catch(t){if("cancel"===t.message)return;console.error(t)}},u=async()=>{r()};chrome.runtime.onMessage.addListener((async t=>{switch(t.type){case"start":await w();break;case"stop":await u();break;case"toggle":c?await u():await w()}}))})();